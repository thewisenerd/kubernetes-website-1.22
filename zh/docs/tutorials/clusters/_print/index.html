<!doctype html><html lang=zh class=no-js>
<head>
<meta name=ROBOTS content="NOINDEX, NOFOLLOW">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JPP6RFM2BP"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-JPP6RFM2BP')</script>
<link rel=alternate hreflang=en href=https://kubernetes.io/docs/tutorials/clusters/>
<link rel=alternate hreflang=ko href=https://kubernetes.io/ko/docs/tutorials/clusters/>
<link rel=alternate hreflang=ja href=https://kubernetes.io/ja/docs/tutorials/clusters/>
<link rel=alternate hreflang=fr href=https://kubernetes.io/fr/docs/tutorials/clusters/>
<link rel=alternate hreflang=es href=https://kubernetes.io/es/docs/tutorials/clusters/>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=generator content="Hugo 0.87.0">
<link rel=canonical type=text/html href=https://kubernetes.io/zh/docs/tutorials/clusters/>
<link rel="shortcut icon" type=image/png href=/images/favicon.png>
<link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180>
<link rel=manifest href=/manifest.webmanifest>
<link rel=apple-touch-icon href=/images/kubernetes-192x192.png>
<title>集群 | Kubernetes</title><meta property="og:title" content="集群">
<meta property="og:description" content="生产级别的容器编排系统">
<meta property="og:type" content="website">
<meta property="og:url" content="https://kubernetes.io/zh/docs/tutorials/clusters/"><meta property="og:site_name" content="Kubernetes">
<meta itemprop=name content="集群">
<meta itemprop=description content="生产级别的容器编排系统"><meta name=twitter:card content="summary">
<meta name=twitter:title content="集群">
<meta name=twitter:description content="生产级别的容器编排系统">
<link href=/scss/main.css rel=stylesheet>
<script src=/js/jquery-3.3.1.min.js integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin=anonymous></script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","url":"https://kubernetes.io","logo":"https://kubernetes.io/images/favicon.png"}</script>
<meta name=theme-color content="#326ce5">
<link rel=stylesheet href=/css/feature-states.css>
<meta name=description content>
<meta property="og:description" content>
<meta name=twitter:description content>
<meta property="og:url" content="https://kubernetes.io/zh/docs/tutorials/clusters/">
<meta property="og:title" content="集群">
<meta name=twitter:title content="集群">
<meta name=twitter:image content="https://kubernetes.io/images/favicon.png">
<meta name=twitter:image:alt content="Kubernetes">
<meta property="og:image" content="/images/kubernetes-horizontal-color.png">
<meta property="og:type" content="article">
<script src=/js/script.js></script>
</head>
<body class=td-section>
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar" data-auto-burger=primary>
<a class=navbar-brand href=/zh/></a>
<div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar>
<ul class="navbar-nav mt-2 mt-lg-0">
<li class="nav-item mr-2 mb-lg-0">
<a class="nav-link active" href=/zh/docs/>文档</span></a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/zh/blog/>Kubernetes 博客</span></a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/zh/training/>培训</span></a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/zh/partners/>合作伙伴</span></a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/zh/community/>社区</span></a>
</li>
<li class="nav-item mr-2 mb-lg-0">
<a class=nav-link href=/zh/case-studies/>案例分析</span></a>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
版本列表
</a>
<div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=/releases>Release Information</a>
<a class=dropdown-item href=https://kubernetes.io/zh/docs/tutorials/clusters/>v1.26</a>
<a class=dropdown-item href=https://v1-25.docs.kubernetes.io/zh/docs/tutorials/clusters/>v1.25</a>
<a class=dropdown-item href=https://v1-24.docs.kubernetes.io/zh/docs/tutorials/clusters/>v1.24</a>
<a class=dropdown-item href=https://v1-23.docs.kubernetes.io/zh/docs/tutorials/clusters/>v1.23</a>
<a class=dropdown-item href=https://v1-22.docs.kubernetes.io/zh/docs/tutorials/clusters/>v1.22</a>
</div>
</li>
<li class="nav-item dropdown">
<a class="nav-link dropdown-toggle" href=# id=navbarDropdownMenuLink role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
中文 Chinese
</a>
<div class="dropdown-menu dropdown-menu-right" aria-labelledby=navbarDropdownMenuLink>
<a class=dropdown-item href=/docs/tutorials/clusters/>English</a>
<a class=dropdown-item href=/ko/docs/tutorials/clusters/>한국어 Korean</a>
<a class=dropdown-item href=/ja/docs/tutorials/clusters/>日本語 Japanese</a>
<a class=dropdown-item href=/fr/docs/tutorials/clusters/>Français</a>
<a class=dropdown-item href=/es/docs/tutorials/clusters/>Español</a>
</div>
</li>
</ul>
</div>
<button id=hamburger onclick=kub.toggleMenu() data-auto-burger-exclude><div></div></button>
</nav>
</header>
<div class="container-fluid td-outer">
<div class=td-main>
<div class="row flex-xl-nowrap">
<div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
</div>
<div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
</div>
<main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main>
<div class=td-content>
<div class="pageinfo pageinfo-primary d-print-none">
<p>
这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.
</p><p>
<a href=/zh/docs/tutorials/clusters/>返回本页常规视图</a>.
</p>
</div>
<h1 class=title>集群</h1>
<ul>
<li>1: <a href=#pg-18353c97948b94e2272afa0f11a58bec>使用 AppArmor 限制容器对资源的访问</a></li>
<li>2: <a href=#pg-6e39761fe48e4761bbc4ece28a20a45b>使用 Seccomp 限制容器的系统调用</a></li>
</ul>
<div class=content>
</div>
</div>
<div class=td-content>
<h1 id=pg-18353c97948b94e2272afa0f11a58bec>1 - 使用 AppArmor 限制容器对资源的访问</h1>
<div style=margin-top:10px;margin-bottom:10px>
<b>FEATURE STATE:</b> <code>Kubernetes v1.4 [beta]</code>
</div>
<p>Apparmor 是一个 Linux 内核安全模块，它补充了标准的基于 Linux 用户和组的安全模块将程序限制为有限资源集的权限。
AppArmor 可以配置为任何应用程序减少潜在的攻击面，并且提供更加深入的防御。
AppArmor 是通过配置文件进行配置的，这些配置文件被调整为允许特定程序或者容器访问，如 Linux 功能、网络访问、文件权限等。
每个配置文件都可以在*强制（enforcing）<em>模式（阻止访问不允许的资源）或</em>投诉（complain）*模式
（仅报告冲突）下运行。</p>
<h2 id=教程目标>教程目标</h2>
<ul>
<li>查看如何在节点上加载配置文件示例</li>
<li>了解如何在 Pod 上强制执行配置文件</li>
<li>了解如何检查配置文件是否已加载</li>
<li>查看违反配置文件时会发生什么情况</li>
<li>查看无法加载配置文件时会发生什么情况</li>
</ul>
<h2 id=准备开始>准备开始</h2>
<p>务必：</p>
<ol>
<li>Kubernetes 版本至少是 v1.4 -- AppArmor 在 Kubernetes v1.4 版本中才添加了对 AppArmor 的支持。早于 v1.4 版本的 Kubernetes 组件不知道新的 AppArmor 注释，并且将会 <strong>默认忽略</strong> 提供的任何 AppArmor 设置。为了确保您的 Pods 能够得到预期的保护，必须验证节点的 Kubelet 版本：</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell> kubectl get nodes -o<span style=color:#666>=</span><span style=color:#b8860b>jsonpath</span><span style=color:#666>=</span><span style=color:#b44>$&#39;{range .items[*]}{@.metadata.name}: {@.status.nodeInfo.kubeletVersion}\n{end}&#39;</span>
</code></pre></div><pre><code>gke-test-default-pool-239f5d02-gyn2: v1.4.0
gke-test-default-pool-239f5d02-x1kf: v1.4.0
gke-test-default-pool-239f5d02-xwux: v1.4.0
</code></pre>
<ol start=2>
<li>AppArmor 内核模块已启用 -- 要使 Linux 内核强制执行 AppArmor 配置文件，必须安装并且启动 AppArmor 内核模块。默认情况下，有几个发行版支持该模块，如 Ubuntu 和 SUSE，还有许多发行版提供可选支持。要检查模块是否已启用，请检查
<code>/sys/module/apparmor/parameters/enabled</code> 文件：</li>
</ol>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell> cat /sys/module/apparmor/parameters/enabled
 Y
</code></pre></div><p>如果 Kubelet 包含 AppArmor 支持(>=v1.4)，如果内核模块未启用，它将拒绝运行带有 AppArmor 选项的 Pod。</p>
<div class="alert alert-info note callout" role=alert>
<strong>说明：</strong> Ubuntu 携带了许多没有合并到上游 Linux 内核中的 AppArmor 补丁，包括添加附加钩子和特性的补丁。Kubernetes 只在上游版本中测试过，不承诺支持其他特性。
</div>
<ol start=3>
<li>
<p>Docker 作为容器运行环境 -- 目前，支持 Kubernetes 运行的容器中只有 Docker 也支持 AppArmor。随着更多的运行时添加 AppArmor 的支持，可选项将会增多。您可以使用以下命令验证节点是否正在运行 Docker:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl get nodes -o<span style=color:#666>=</span><span style=color:#b8860b>jsonpath</span><span style=color:#666>=</span><span style=color:#b44>$&#39;{range .items[*]}{@.metadata.name}: {@.status.nodeInfo.containerRuntimeVersion}\n{end}&#39;</span>
</code></pre></div><pre><code>gke-test-default-pool-239f5d02-gyn2: docker://1.11.2
gke-test-default-pool-239f5d02-x1kf: docker://1.11.2
gke-test-default-pool-239f5d02-xwux: docker://1.11.2
</code></pre><p>如果 Kubelet 包含 AppArmor 支持(>=v1.4)，如果运行环境不是 Docker，它将拒绝运行带有 AppArmor 选项的 Pod。</p>
</li>
</ol>
<ol start=4>
<li>
<p>配置文件已加载 -- 通过指定每个容器都应使用 AppArmor 配置文件，AppArmor 应用于 Pod。如果指定的任何配置文件尚未加载到内核， Kubelet (>=v1.4) 将拒绝 Pod。通过检查 <code>/sys/kernel/security/apparmor/profiles</code> 文件，可以查看节点加载了哪些配置文件。例如:</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>ssh gke-test-default-pool-239f5d02-gyn2 <span style=color:#b44>&#34;sudo cat /sys/kernel/security/apparmor/profiles | sort&#34;</span>
</code></pre></div><pre><code>apparmor-test-deny-write (enforce)
apparmor-test-audit-write (enforce)
docker-default (enforce)
k8s-nginx (enforce)
</code></pre>
<p>有关在节点上加载配置文件的详细信息，请参见<a href=#setting-up-nodes-with-profiles>使用配置文件设置节点</a>。</p>
</li>
</ol>
<p>只要 Kubelet 版本包含 AppArmor 支持(>=v1.4)，如果不满足任何先决条件，Kubelet 将拒绝带有 AppArmor 选项的 Pod。您还可以通过检查节点就绪状况消息来验证节点上的 AppArmor 支持(尽管这可能会在以后的版本中删除)：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl get nodes -o<span style=color:#666>=</span><span style=color:#b8860b>jsonpath</span><span style=color:#666>=</span><span style=color:#b44>$&#39;{range .items[*]}{@.metadata.name}: {.status.conditions[?(@.reason==&#34;KubeletReady&#34;)].message}\n{end}&#39;</span>
</code></pre></div><pre><code>gke-test-default-pool-239f5d02-gyn2: kubelet is posting ready status. AppArmor enabled
gke-test-default-pool-239f5d02-x1kf: kubelet is posting ready status. AppArmor enabled
gke-test-default-pool-239f5d02-xwux: kubelet is posting ready status. AppArmor enabled
</code></pre>
<h2 id=保护-pod>保护 Pod</h2>
<div class="alert alert-info note callout" role=alert>
<strong>说明：</strong>
<p>AppArmor 目前处于测试阶段，因此选项被指定为注释。一旦 AppArmor 被授予支持通用，注释将替换为首要的字段(更多详情参见<a href=#upgrade-path-to-general-availability>升级到 GA 的途径</a>)。
</div>
<p>AppArmor 配置文件被指定为 <em>per-container</em>。要指定要用其运行 Pod 容器的 AppArmor 配置文件，请向 Pod 的元数据添加注释：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>container.apparmor.security.beta.kubernetes.io/&lt;container_name&gt;</span>:<span style=color:#bbb> </span>&lt;profile_ref&gt;<span style=color:#bbb>
</span></code></pre></div>
<p><code>&lt;container_name></code> 的名称是容器的简称，用以描述简介，并且简称为 <code>&lt;profile_ref></code> 。<code>&lt;profile_ref></code> 可以作为其中之一：</p>
<ul>
<li><code>runtime/default</code> 应用运行时的默认配置</li>
<li><code>localhost/&lt;profile_name></code> 应用在名为 <code>&lt;profile_name></code> 的主机上加载的配置文件</li>
<li><code>unconfined</code> 表示不加载配置文件</li>
</ul>
<p>有关注释和配置文件名称格式的详细信息，请参阅<a href=#api-reference>API 参考</a>。</p>
<p>Kubernetes AppArmor 强制执行方式首先通过检查所有先决条件都已满足，然后将配置文件选择转发到容器运行时进行强制执行。如果未满足先决条件， Pod 将被拒绝，并且不会运行。</p>
<p>要验证是否应用了配置文件，可以查找容器创建事件中列出的 AppArmor 安全选项：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl get events | grep Created
</code></pre></div><pre><code>22s        22s         1         hello-apparmor     Pod       spec.containers{hello}   Normal    Created     {kubelet e2e-test-stclair-node-pool-31nt}   Created container with docker id 269a53b202d3; Security:[seccomp=unconfined apparmor=k8s-apparmor-example-deny-write]
</code></pre>
<p>您还可以通过检查容器的 proc attr，直接验证容器的根进程是否以正确的配置文件运行：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl <span style=color:#a2f>exec</span> &lt;pod_name&gt; cat /proc/1/attr/current
</code></pre></div><pre><code>k8s-apparmor-example-deny-write (enforce)
</code></pre>
<h2 id=举例>举例</h2>
<p><em>本例假设您已经使用 AppArmor 支持设置了一个集群。</em></p>
<p>首先，我们需要将要使用的配置文件加载到节点上。配置文件拒绝所有文件写入：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#080;font-style:italic>#include &lt;tunables/global&gt;</span>
profile k8s-apparmor-example-deny-write <span style=color:#b8860b>flags</span><span style=color:#666>=(</span>attach_disconnected<span style=color:#666>)</span> <span style=color:#666>{</span>
  <span style=color:#080;font-style:italic>#include &lt;abstractions/base&gt;</span>
  file,
  <span style=color:#080;font-style:italic># Deny all file writes.</span>
  deny /** w,
<span style=color:#666>}</span>
</code></pre></div>
<p>由于我们不知道 Pod 将被调度到哪里，我们需要在所有节点上加载配置文件。
在本例中，我们将使用 SSH 来安装概要文件，但是在<a href=#setting-up-nodes-with-profiles>使用配置文件设置节点</a>
中讨论了其他方法。</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#b8860b>NODES</span><span style=color:#666>=(</span>
    <span style=color:#080;font-style:italic># The SSH-accessible domain names of your nodes</span>
    gke-test-default-pool-239f5d02-gyn2.us-central1-a.my-k8s
    gke-test-default-pool-239f5d02-x1kf.us-central1-a.my-k8s
    gke-test-default-pool-239f5d02-xwux.us-central1-a.my-k8s<span style=color:#666>)</span>
<span style=color:#a2f;font-weight:700>for</span> NODE in <span style=color:#b68;font-weight:700>${</span><span style=color:#b8860b>NODES</span>[*]<span style=color:#b68;font-weight:700>}</span>; <span style=color:#a2f;font-weight:700>do</span> ssh <span style=color:#b8860b>$NODE</span> <span style=color:#b44>&#39;sudo apparmor_parser -q &lt;&lt;EOF
</span><span style=color:#b44>#include &lt;tunables/global&gt;
</span><span style=color:#b44>
</span><span style=color:#b44>profile k8s-apparmor-example-deny-write flags=(attach_disconnected) {
</span><span style=color:#b44>  #include &lt;abstractions/base&gt;
</span><span style=color:#b44>
</span><span style=color:#b44>  file,
</span><span style=color:#b44>
</span><span style=color:#b44>  # Deny all file writes.
</span><span style=color:#b44>  deny /** w,
</span><span style=color:#b44>}
</span><span style=color:#b44>EOF&#39;</span>
<span style=color:#a2f;font-weight:700>done</span>
</code></pre></div>
<p>接下来，我们将运行一个带有拒绝写入配置文件的简单 "Hello AppArmor" pod：</p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/security/hello-apparmor.yaml download=pods/security/hello-apparmor.yaml><code>pods/security/hello-apparmor.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-security-hello-apparmor-yaml')" title="Copy pods/security/hello-apparmor.yaml to clipboard">
</img>
</div>
<div class=includecode id=pods-security-hello-apparmor-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>hello-apparmor<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># Tell Kubernetes to apply the AppArmor profile &#34;k8s-apparmor-example-deny-write&#34;.</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:#080;font-style:italic># Note that this is ignored if the Kubernetes node is not running version 1.4 or greater.</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>container.apparmor.security.beta.kubernetes.io/hello</span>:<span style=color:#bbb> </span>localhost/k8s-apparmor-example-deny-write<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>hello<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>busybox<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#bbb> </span><span style=color:#b44>&#34;sh&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;-c&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;echo &#39;Hello AppArmor!&#39; &amp;&amp; sleep 1h&#34;</span><span style=color:#bbb> </span>]<span style=color:#bbb>
</span></code></pre></div>
</div>
</div>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl create -f ./hello-apparmor.yaml
</code></pre></div>
<p>如果我们查看 pod 事件，我们可以看到 pod 容器是用 AppArmor 配置文件 "k8s-apparmor-example-deny-write" 所创建的：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl get events | grep hello-apparmor
</code></pre></div><pre><code>14s        14s         1         hello-apparmor   Pod                                Normal    Scheduled   {default-scheduler }                           Successfully assigned hello-apparmor to gke-test-default-pool-239f5d02-gyn2
14s        14s         1         hello-apparmor   Pod       spec.containers{hello}   Normal    Pulling     {kubelet gke-test-default-pool-239f5d02-gyn2}   pulling image &quot;busybox&quot;
13s        13s         1         hello-apparmor   Pod       spec.containers{hello}   Normal    Pulled      {kubelet gke-test-default-pool-239f5d02-gyn2}   Successfully pulled image &quot;busybox&quot;
13s        13s         1         hello-apparmor   Pod       spec.containers{hello}   Normal    Created     {kubelet gke-test-default-pool-239f5d02-gyn2}   Created container with docker id 06b6cd1c0989; Security:[seccomp=unconfined apparmor=k8s-apparmor-example-deny-write]
13s        13s         1         hello-apparmor   Pod       spec.containers{hello}   Normal    Started     {kubelet gke-test-default-pool-239f5d02-gyn2}   Started container with docker id 06b6cd1c0989
</code></pre>
<p>我们可以通过检查该配置文件的 proc attr 来验证容器是否实际使用该配置文件运行：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl <span style=color:#a2f>exec</span> hello-apparmor -- cat /proc/1/attr/current
</code></pre></div><pre><code>k8s-apparmor-example-deny-write (enforce)
</code></pre>
<p>最后，我们可以看到如果试图通过写入文件来违反配置文件，会发生什么情况：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl <span style=color:#a2f>exec</span> hello-apparmor -- touch /tmp/test
</code></pre></div><pre><code>touch: /tmp/test: Permission denied
error: error executing remote command: command terminated with non-zero exit code: Error executing in Docker Container: 1
</code></pre>
<p>最后，让我们看看如果我们试图指定一个尚未加载的配置文件会发生什么：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl create -f /dev/stdin &lt;&lt;EOF
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>hello-apparmor-2<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>container.apparmor.security.beta.kubernetes.io/hello</span>:<span style=color:#bbb> </span>localhost/k8s-apparmor-example-allow-write<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>hello<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>busybox<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>command</span>:<span style=color:#bbb> </span>[<span style=color:#bbb> </span><span style=color:#b44>&#34;sh&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;-c&#34;</span>,<span style=color:#bbb> </span><span style=color:#b44>&#34;echo &#39;Hello AppArmor!&#39; &amp;&amp; sleep 1h&#34;</span><span style=color:#bbb> </span>]<span style=color:#bbb>
</span><span style=color:#bbb></span>EOF<span style=color:#bbb>
</span><span style=color:#bbb></span>pod/hello-apparmor-2 created<span style=color:#bbb>
</span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>kubectl describe pod hello-apparmor-2
</code></pre></div><pre><code>Name:          hello-apparmor-2
Namespace:     default
Node:          gke-test-default-pool-239f5d02-x1kf/
Start Time:    Tue, 30 Aug 2016 17:58:56 -0700
Labels:        &lt;none&gt;
Annotations:   container.apparmor.security.beta.kubernetes.io/hello=localhost/k8s-apparmor-example-allow-write
Status:        Pending
Reason:        AppArmor
Message:       Pod Cannot enforce AppArmor: profile &quot;k8s-apparmor-example-allow-write&quot; is not loaded
IP:
Controllers:   &lt;none&gt;
Containers:
  hello:
    Container ID:
    Image:     busybox
    Image ID:
    Port:
    Command:
      sh
      -c
      echo 'Hello AppArmor!' &amp;&amp; sleep 1h
    State:              Waiting
      Reason:           Blocked
    Ready:              False
    Restart Count:      0
    Environment:        &lt;none&gt;
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-dnz7v (ro)
Conditions:
  Type          Status
  Initialized   True
  Ready         False
  PodScheduled  True
Volumes:
  default-token-dnz7v:
    Type:    Secret (a volume populated by a Secret)
    SecretName:    default-token-dnz7v
    Optional:   false
QoS Class:      BestEffort
Node-Selectors: &lt;none&gt;
Tolerations:    &lt;none&gt;
Events:
  FirstSeen    LastSeen    Count    From                        SubobjectPath    Type        Reason        Message
  ---------    --------    -----    ----                        -------------    --------    ------        -------
  23s          23s         1        {default-scheduler }                         Normal      Scheduled     Successfully assigned hello-apparmor-2 to e2e-test-stclair-node-pool-t1f5
  23s          23s         1        {kubelet e2e-test-stclair-node-pool-t1f5}             Warning        AppArmor    Cannot enforce AppArmor: profile &quot;k8s-apparmor-example-allow-write&quot; is not loaded
</code></pre>
<p>注意 pod 呈现 Pending 状态，并且显示一条有用的错误信息：<code>Pod Cannot enforce AppArmor: profile "k8s-apparmor-example-allow-write" 未加载</code>。还用相同的消息记录了一个事件。</p>
<h2 id=管理>管理</h2>
<h3 id=使用配置文件设置节点>使用配置文件设置节点</h3>
<p>Kubernetes 目前不提供任何本地机制来将 AppArmor 配置文件加载到节点上。有很多方法可以设置配置文件，例如：</p>
<ul>
<li>通过在每个节点上运行 Pod 的<a href=/zh/docs/concepts/workloads/controllers/daemonset/>DaemonSet</a>确保加载了正确的配置文件。可以找到一个示例实现<a href=https://git.k8s.io/kubernetes/test/images/apparmor-loader>这里</a>。</li>
<li>在节点初始化时，使用节点初始化脚本(例如 Salt 、Ansible 等)或镜像。</li>
<li>通过将配置文件复制到每个节点并通过 SSH 加载它们，如<a href=#example>示例</a>。</li>
</ul>
<p>调度程序不知道哪些配置文件加载到哪个节点上，因此必须将全套配置文件加载到每个节点上。另一种方法是为节点上的每个配置文件(或配置文件类)添加节点标签，并使用[节点选择器](/zh/docs/concepts/configuration/assign pod node/)确保 Pod 在具有所需配置文件的节点上运行。</p>
<h3 id=使用-podsecuritypolicy-限制配置文件>使用 PodSecurityPolicy 限制配置文件</h3>
<div class="alert alert-info note callout" role=alert>
<strong>说明：</strong>
<p>PodSecurityPolicy 在 Kubernetes v1.21 版本中已被废弃，将在 v1.25 版本移除。
查看 <a href=/zh/docs/concepts/policy/pod-security-policy/>PodSecurityPolicy 文档</a>获取更多信息。
</div>
<p>如果启用了 PodSecurityPolicy 扩展，则可以应用群集范围的 AppArmor 限制。要启用 PodSecurityPolicy，必须在“apiserver”上设置以下标志：</p>
<pre><code>--enable-admission-plugins=PodSecurityPolicy[,others...]
</code></pre>
<p>AppArmor 选项可以指定为 PodSecurityPolicy 上的注释：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apparmor.security.beta.kubernetes.io/defaultProfileName</span>:<span style=color:#bbb> </span>&lt;profile_ref&gt;<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>apparmor.security.beta.kubernetes.io/allowedProfileNames</span>:<span style=color:#bbb> </span>&lt;profile_ref&gt;[,others...]<span style=color:#bbb>
</span></code></pre></div>
<p>默认配置文件名选项指定默认情况下在未指定任何配置文件时应用于容器的配置文件。节点允许配置文件名选项指定允许 Pod 容器运行时的配置文件列表。配置文件的指定格式与容器上的相同。完整规范见<a href=#api-reference>API 参考</a>。</p>
<h3 id=禁用-apparmor>禁用 AppArmor</h3>
<p>如果您不希望 AppArmor 在集群上可用，可以通过命令行标志禁用它：</p>
<pre><code>--feature-gates=AppArmor=false
</code></pre>
<p>禁用时，任何包含 AppArmor 配置文件的 Pod 都将因 "Forbidden" 错误而导致验证失败。注意，默认情况下，docker 总是在非特权 pods 上启用 "docker-default" 配置文件(如果 AppArmor 内核模块已启用)，并且即使功能门已禁用，也将继续启用该配置文件。当 AppArmor 应用于通用(GA)时，禁用 Apparmor 的选项将被删除。</p>
<h3 id=使用-apparmor-升级到-kubernetes-v1-4>使用 AppArmor 升级到 Kubernetes v1.4</h3>
<p>不需要对 AppArmor 执行任何操作即可将集群升级到 v1.4。但是，如果任何现有的 pods 有一个 AppArmor 注释，它们将不会通过验证(或 PodSecurityPolicy 认证)。如果节点上加载了许可配置文件，恶意用户可以预先应用许可配置文件，将 pod 权限提升到 docker-default 权限之上。如果存在这个问题，建议清除包含 <code>apparmor.security.beta.kubernetes.io</code> 注释的任何 pods 的集群。</p>
<h3 id=升级到一般可用性的途径>升级到一般可用性的途径</h3>
<p>当 Apparmor 准备升级到通用(GA)时，当前指定的选项通过注释将转换为字段。通过转换支持所有升级和降级路径是非常微妙的，并将在转换发生时详细解释。我们将承诺在至少两个版本中同时支持字段和注释，并在之后的至少两个版本中显式拒绝注释。</p>
<h2 id=编写配置文件>编写配置文件</h2>
<p>获得正确指定的 AppArmor 配置文件可能是一件棘手的事情。幸运的是，有一些工具可以帮助您做到这一点：</p>
<ul>
<li><code>aa-genprof</code> and <code>aa-logprof</code> 通过监视应用程序的活动和日志并承认它所采取的操作来生成配置文件规则。更多说明由<a href=https://gitlab.com/apparmor/apparmor/wikis/Profiling_with_tools>AppArmor 文档</a>提供。</li>
<li><a href=https://github.com/jfrazelle/bane>bane</a>是一个用于 Docker的 AppArmor 档案生成器，它使用简化的档案语言。</li>
</ul>
<p>建议在开发工作站上通过 Docker 运行应用程序以生成配置文件，但是没有什么可以阻止在运行 Pod 的 Kubernetes 节点上运行工具。</p>
<p>想要调试 AppArmor 的问题，您可以检查系统日志，查看具体拒绝了什么。AppArmor 将详细消息记录到 <code>dmesg</code> ，错误通常可以在系统日志中或通过 <code>journalctl</code> 找到。更多详细信息见<a href=https://gitlab.com/apparmor/apparmor/wikis/AppArmor_Failures>AppArmor 失败</a>。</p>
<h2 id=api-参考>API 参考</h2>
<h3 id=pod-注释>Pod 注释</h3>
<p>指定容器将使用的配置文件：</p>
<ul>
<li><strong>key</strong>: <code>container.apparmor.security.beta.kubernetes.io/&lt;container_name></code> 中的 <code>&lt;container_name></code> 匹配 Pod 中的容器名称。
可以为 Pod 中的每个容器指定单独的配置文件。</li>
<li><strong>value</strong>: 配置文件参考，如下所述</li>
</ul>
<h3 id=配置文件参考>配置文件参考</h3>
<ul>
<li><code>runtime/default</code>: 指默认运行时配置文件。
<ul>
<li>等同于不指定配置文件(没有 PodSecurityPolicy 默认值)，除非它仍然需要启用 AppArmor。</li>
<li>对于 Docker，这将解析为非特权容器的<a href=https://docs.docker.com/engine/security/apparmor/><code>Docker default</code></a>配置文件，特权容器的配置文件为未定义(无配置文件)。</li>
</ul>
</li>
<li><code>localhost/&lt;profile_name></code>: 指按名称加载到节点(localhost)上的配置文件。
<ul>
<li>可能的配置文件名在 <a href=https://gitlab.com/apparmor/apparmor/wikis/AppArmor_Core_Policy_Reference#profile-names-and-attachment-specifications>核心策略参考</a>。</li>
</ul>
</li>
<li><code>unconfined</code>: 这有效地禁用了容器上的 AppArmor 。</li>
</ul>
<p>任何其他配置文件引用格式无效。</p>
<h3 id=podsecuritypolicy-注解>PodSecurityPolicy 注解</h3>
<p>指定在未提供容器时应用于容器的默认配置文件：</p>
<ul>
<li><strong>key</strong>: <code>apparmor.security.beta.kubernetes.io/defaultProfileName</code></li>
<li><strong>value</strong>: 如上述文件参考所述</li>
</ul>
<p>上面描述的指定配置文件， Pod 容器列表的配置文件引用允许指定：</p>
<ul>
<li><strong>key</strong>: <code>apparmor.security.beta.kubernetes.io/allowedProfileNames</code></li>
<li><strong>value</strong>: 配置文件引用的逗号分隔列表(如上所述)
<ul>
<li>尽管转义逗号是配置文件名中的合法字符，但此处不能显式允许。</li>
</ul>
</li>
</ul>
<h2 id=接下来>接下来</h2>
<p>其他资源</p>
<ul>
<li><a href=https://gitlab.com/apparmor/apparmor/wikis/QuickProfileLanguage>Apparmor 配置文件语言快速指南</a></li>
<li><a href=https://gitlab.com/apparmor/apparmor/wikis/Policy_Layout>Apparmor 核心策略参考</a></li>
</ul>
</div>
<div class=td-content style=page-break-before:always>
<h1 id=pg-6e39761fe48e4761bbc4ece28a20a45b>2 - 使用 Seccomp 限制容器的系统调用</h1>
<div style=margin-top:10px;margin-bottom:10px>
<b>FEATURE STATE:</b> <code>Kubernetes v1.19 [stable]</code>
</div>
<p>Seccomp 代表安全计算模式，自 2.6.12 版本以来一直是 Linux 内核的功能。
它可以用来对进程的特权进行沙盒处理，从而限制了它可以从用户空间向内核进行的调用。
Kubernetes 允许你将加载到节点上的 seccomp 配置文件自动应用于 Pod 和容器。</p>
<p>确定工作负载所需的特权可能很困难。在本教程中，你将了解如何将 seccomp 配置文件
加载到本地 Kubernetes 集群中，如何将它们应用到 Pod，以及如何开始制作仅向容器
进程提供必要特权的配置文件。</p>
<h2 id=教程目标>教程目标</h2>
<ul>
<li>了解如何在节点上加载 seccomp 配置文件</li>
<li>了解如何将 seccomp 配置文件应用于容器</li>
<li>观察由容器进程进行的系统调用的审核</li>
<li>观察当指定了一个不存在的配置文件时的行为</li>
<li>观察违反 seccomp 配置的情况</li>
<li>了解如何创建精确的 seccomp 配置文件</li>
<li>了解如何应用容器运行时默认 seccomp 配置文件</li>
</ul>
<h2 id=准备开始>准备开始</h2>
您的 Kubernetes 服务器版本必须是 v1.22.
要获知版本信息，请输入 <code>kubectl version</code>.
<p>为了完成本教程中的所有步骤，你必须安装 <a href=https://kind.sigs.k8s.io/docs/user/quick-start/>kind</a>
和 <a href=/zh/docs/tasks/tools/>kubectl</a>。本教程将显示同时具有 alpha（v1.22 新版本）
和通常可用的 seccomp 功能的示例。
你应该确保为所使用的版本<a href=https://kind.sigs.k8s.io/docs/user/quick-start/#setting-kubernetes-version>正确配置</a>了集群。</p>
<h2 id=启用-runtimedefault-作为所有工作负载的默认-seccomp-配置文件>启用 <code>RuntimeDefault</code> 作为所有工作负载的默认 seccomp 配置文件</h2>
<div style=margin-top:10px;margin-bottom:10px>
<b>FEATURE STATE:</b> <code>Kubernetes v1.22 [alpha]</code>
</div>
<p><code>SeccompDefault</code> 是一个可选的 kubelet
<a href=/zh/docs/reference/command-line-tools-reference/feature-gates>特性门控</a>，
相应地，<code>--seccomp-default</code> 是此特性门控的
<a href=/zh/docs/reference/command-line-tools-reference/kubelet>命令行标志</a>。
必须同时启用两者才能使用该功能。</p>
<p>如果启用，kubelet 将默认使用 <code>RuntimeDefault</code> seccomp 配置，
而不是使用 <code>Unconfined</code>（禁用 seccomp）模式，该配置由容器运行时定义。
默认配置旨在提供一组强大的安全默认值设置，同时避免影响工作负载的功能。
不同的容器运行时之间及其不同的发布版本之间的默认配置可能不同，
例如在比较 CRI-O 和 containerd 的配置文件时（就会发现这点）。</p>
<p>某些工作负载可能相比其他工作负载需要更少的系统调用限制。
这意味着即使使用 <code>RuntimeDefault</code> 配置文件，它们也可能在运行时失败。
要处理此类失效，你可以：</p>
<ul>
<li>将工作负载显式运行为 <code>Unconfined</code>。</li>
<li>禁用节点的 <code>SeccompDefault</code> 功能。
还要确保工作负载被安排在禁用该功能的节点上。</li>
<li>为工作负载创建自定义 seccomp 配置文件。</li>
</ul>
<p>如果你将此功能引入到类似生产的集群中，
Kubernetes 项目建议你在节点的子集上启用此特性门控，
然后在集群范围内推出更改之前测试工作负载的执行情况。</p>
<p>有关可能的升级和降级策略的更多详细信息，
请参见<a href=https://github.com/kubernetes/enhancements/tree/a70cc18/keps/sig-node/2413-seccomp-by-default#upgrade--downgrade-strategy>相关 Kubernetes 增强提案 (KEP)</a>。</p>
<p>由于该功能处于 alpha 状态，因此默认情况下是被禁用的。要启用它，
请将标志 <code>--feature-gates=SeccompDefault=true --seccomp-default</code>
传递给 <code>kubelet</code> CLI 或通过
<a href=/zh/docs/tasks/administer-cluster/kubelet-config-file/>kubelet 配置文件</a>启用它。
要在 <a href=https://kind.sigs.k8s.io>kind</a> 中启用特性门控，
请确保 <code>kind</code> 提供所需的最低 Kubernetes 版本并
<a href=https://kind.sigs.k8s.io/docs/user/quick-start/#enable-feature-gates-in-your-cluster>在 kind 配置中</a>
启用 <code>SeccompDefault</code> 功能：</p>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Cluster<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>kind.x-k8s.io/v1alpha4<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>featureGates</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>SeccompDefault</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>true</span><span style=color:#bbb>
</span></code></pre></div>
<h2 id=创建-seccomp-文件>创建 Seccomp 文件</h2>
<p>这些配置文件的内容将在以后进行探讨，但现在继续进行，并将其下载到名为 <code>profiles/</code> 的目录中，以便可以将其加载到集群中。</p>
<ul class="nav nav-tabs" id=tab-with-code role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#tab-with-code-0 role=tab aria-controls=tab-with-code-0 aria-selected=true>audit.json</a></li>
<li class=nav-item><a data-toggle=tab class=nav-link href=#tab-with-code-1 role=tab aria-controls=tab-with-code-1>violation.json</a></li>
<li class=nav-item><a data-toggle=tab class=nav-link href=#tab-with-code-2 role=tab aria-controls=tab-with-code-2>fine-grained.json</a></li></ul>
<div class=tab-content id=tab-with-code><div id=tab-with-code-0 class="tab-pane show active" role=tabpanel aria-labelledby=tab-with-code-0>
<p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/security/seccomp/profiles/audit.json download=pods/security/seccomp/profiles/audit.json><code>pods/security/seccomp/profiles/audit.json</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-security-seccomp-profiles-audit-json')" title="Copy pods/security/seccomp/profiles/audit.json to clipboard">
</img>
</div>
<div class=includecode id=pods-security-seccomp-profiles-audit-json>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:green;font-weight:700>&#34;defaultAction&#34;</span>: <span style=color:#b44>&#34;SCMP_ACT_LOG&#34;</span>
}</code></pre></div>
</div>
</div>
</div>
<div id=tab-with-code-1 class=tab-pane role=tabpanel aria-labelledby=tab-with-code-1>
<p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/security/seccomp/profiles/violation.json download=pods/security/seccomp/profiles/violation.json><code>pods/security/seccomp/profiles/violation.json</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-security-seccomp-profiles-violation-json')" title="Copy pods/security/seccomp/profiles/violation.json to clipboard">
</img>
</div>
<div class=includecode id=pods-security-seccomp-profiles-violation-json>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:green;font-weight:700>&#34;defaultAction&#34;</span>: <span style=color:#b44>&#34;SCMP_ACT_ERRNO&#34;</span>
}</code></pre></div>
</div>
</div>
</div>
<div id=tab-with-code-2 class=tab-pane role=tabpanel aria-labelledby=tab-with-code-2>
<p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/security/seccomp/profiles/fine-grained.json download=pods/security/seccomp/profiles/fine-grained.json><code>pods/security/seccomp/profiles/fine-grained.json</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-security-seccomp-profiles-fine-grained-json')" title="Copy pods/security/seccomp/profiles/fine-grained.json to clipboard">
</img>
</div>
<div class=includecode id=pods-security-seccomp-profiles-fine-grained-json>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=color:green;font-weight:700>&#34;defaultAction&#34;</span>: <span style=color:#b44>&#34;SCMP_ACT_ERRNO&#34;</span>,
    <span style=color:green;font-weight:700>&#34;architectures&#34;</span>: [
        <span style=color:#b44>&#34;SCMP_ARCH_X86_64&#34;</span>,
        <span style=color:#b44>&#34;SCMP_ARCH_X86&#34;</span>,
        <span style=color:#b44>&#34;SCMP_ARCH_X32&#34;</span>
    ],
    <span style=color:green;font-weight:700>&#34;syscalls&#34;</span>: [
        {
            <span style=color:green;font-weight:700>&#34;names&#34;</span>: [
                <span style=color:#b44>&#34;accept4&#34;</span>,
                <span style=color:#b44>&#34;epoll_wait&#34;</span>,
                <span style=color:#b44>&#34;pselect6&#34;</span>,
                <span style=color:#b44>&#34;futex&#34;</span>,
                <span style=color:#b44>&#34;madvise&#34;</span>,
                <span style=color:#b44>&#34;epoll_ctl&#34;</span>,
                <span style=color:#b44>&#34;getsockname&#34;</span>,
                <span style=color:#b44>&#34;setsockopt&#34;</span>,
                <span style=color:#b44>&#34;vfork&#34;</span>,
                <span style=color:#b44>&#34;mmap&#34;</span>,
                <span style=color:#b44>&#34;read&#34;</span>,
                <span style=color:#b44>&#34;write&#34;</span>,
                <span style=color:#b44>&#34;close&#34;</span>,
                <span style=color:#b44>&#34;arch_prctl&#34;</span>,
                <span style=color:#b44>&#34;sched_getaffinity&#34;</span>,
                <span style=color:#b44>&#34;munmap&#34;</span>,
                <span style=color:#b44>&#34;brk&#34;</span>,
                <span style=color:#b44>&#34;rt_sigaction&#34;</span>,
                <span style=color:#b44>&#34;rt_sigprocmask&#34;</span>,
                <span style=color:#b44>&#34;sigaltstack&#34;</span>,
                <span style=color:#b44>&#34;gettid&#34;</span>,
                <span style=color:#b44>&#34;clone&#34;</span>,
                <span style=color:#b44>&#34;bind&#34;</span>,
                <span style=color:#b44>&#34;socket&#34;</span>,
                <span style=color:#b44>&#34;openat&#34;</span>,
                <span style=color:#b44>&#34;readlinkat&#34;</span>,
                <span style=color:#b44>&#34;exit_group&#34;</span>,
                <span style=color:#b44>&#34;epoll_create1&#34;</span>,
                <span style=color:#b44>&#34;listen&#34;</span>,
                <span style=color:#b44>&#34;rt_sigreturn&#34;</span>,
                <span style=color:#b44>&#34;sched_yield&#34;</span>,
                <span style=color:#b44>&#34;clock_gettime&#34;</span>,
                <span style=color:#b44>&#34;connect&#34;</span>,
                <span style=color:#b44>&#34;dup2&#34;</span>,
                <span style=color:#b44>&#34;epoll_pwait&#34;</span>,
                <span style=color:#b44>&#34;execve&#34;</span>,
                <span style=color:#b44>&#34;exit&#34;</span>,
                <span style=color:#b44>&#34;fcntl&#34;</span>,
                <span style=color:#b44>&#34;getpid&#34;</span>,
                <span style=color:#b44>&#34;getuid&#34;</span>,
                <span style=color:#b44>&#34;ioctl&#34;</span>,
                <span style=color:#b44>&#34;mprotect&#34;</span>,
                <span style=color:#b44>&#34;nanosleep&#34;</span>,
                <span style=color:#b44>&#34;open&#34;</span>,
                <span style=color:#b44>&#34;poll&#34;</span>,
                <span style=color:#b44>&#34;recvfrom&#34;</span>,
                <span style=color:#b44>&#34;sendto&#34;</span>,
                <span style=color:#b44>&#34;set_tid_address&#34;</span>,
                <span style=color:#b44>&#34;setitimer&#34;</span>,
                <span style=color:#b44>&#34;writev&#34;</span>
            ],
            <span style=color:green;font-weight:700>&#34;action&#34;</span>: <span style=color:#b44>&#34;SCMP_ACT_ALLOW&#34;</span>
        }
    ]
}</code></pre></div>
</div>
</div>
</div></div>
<h2 id=使用-kind-创建一个本地-kubernetes-集群>使用 Kind 创建一个本地 Kubernetes 集群</h2>
<p>为简单起见，可以使用 <a href=https://kind.sigs.k8s.io/>kind</a> 创建一个已经加载 seccomp 配置文件的单节点集群。
Kind 在 Docker 中运行 Kubernetes，因此集群的每个节点都是一个容器。这允许将文件挂载到每个容器的文件系统中，
类似于将文件挂载到节点上。</p>
<p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/security/seccomp/kind.yaml download=pods/security/seccomp/kind.yaml><code>pods/security/seccomp/kind.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-security-seccomp-kind-yaml')" title="Copy pods/security/seccomp/kind.yaml to clipboard">
</img>
</div>
<div class=includecode id=pods-security-seccomp-kind-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>kind.x-k8s.io/v1alpha4<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Cluster<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>nodes</span>:<span style=color:#bbb>
</span><span style=color:#bbb></span>- <span style=color:green;font-weight:700>role</span>:<span style=color:#bbb> </span>control-plane<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>extraMounts</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>hostPath</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;./profiles&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>containerPath</span>:<span style=color:#bbb> </span><span style=color:#b44>&#34;/var/lib/kubelet/seccomp/profiles&#34;</span></code></pre></div>
</div>
</div>
<br></p>
<p>下载上面的这个示例，并将其保存为 <code>kind.yaml</code>。然后使用这个配置创建集群。</p>
<pre><code>kind create cluster --config=kind.yaml
</code></pre>
<p>一旦这个集群已经就绪，找到作为单节点集群运行的容器：</p>
<pre><code>docker ps
</code></pre>
<p>你应该看到输出显示正在运行的容器名称为 <code>kind-control-plane</code>。</p>
<pre><code>CONTAINER ID        IMAGE                  COMMAND                  CREATED             STATUS              PORTS                       NAMES
6a96207fed4b        kindest/node:v1.18.2   &quot;/usr/local/bin/entr…&quot;   27 seconds ago      Up 24 seconds       127.0.0.1:42223-&gt;6443/tcp   kind-control-plane
</code></pre>
<p>如果观察该容器的文件系统，则应该看到 <code>profiles/</code> 目录已成功加载到 kubelet 的默认 seccomp 路径中。
使用 <code>docker exec</code> 在 Pod 中运行命令：</p>
<pre><code>docker exec -it 6a96207fed4b ls /var/lib/kubelet/seccomp/profiles
</code></pre><pre><code>audit.json  fine-grained.json  violation.json
</code></pre>
<h2 id=使用-seccomp-配置文件创建-pod-以进行系统调用审核>使用 seccomp 配置文件创建 Pod 以进行系统调用审核</h2>
<p>首先，将 <code>audit.json</code> 配置文件应用到新的 Pod 中，该配置文件将记录该进程的所有系统调用。</p>
<p>为你的 Kubernetes 版本下载正确的清单：</p>
<p><ul class="nav nav-tabs" id=audit-pods role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#audit-pods-0 role=tab aria-controls=audit-pods-0 aria-selected=true>v1.19 或更新版本（GA）</a></li>
<li class=nav-item><a data-toggle=tab class=nav-link href=#audit-pods-1 role=tab aria-controls=audit-pods-1>v1.19之前版本（alpha）</a></li></ul>
<div class=tab-content id=audit-pods><div id=audit-pods-0 class="tab-pane show active" role=tabpanel aria-labelledby=audit-pods-0>
<p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/security/seccomp/ga/audit-pod.yaml download=pods/security/seccomp/ga/audit-pod.yaml><code>pods/security/seccomp/ga/audit-pod.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-security-seccomp-ga-audit-pod-yaml')" title="Copy pods/security/seccomp/ga/audit-pod.yaml to clipboard">
</img>
</div>
<div class=includecode id=pods-security-seccomp-ga-audit-pod-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>audit-pod<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>audit-pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>seccompProfile</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Localhost<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>localhostProfile</span>:<span style=color:#bbb> </span>profiles/audit.json<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>test-container<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>hashicorp/http-echo:0.2.3<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#34;-text=just made some syscalls!&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>allowPrivilegeEscalation</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span></code></pre></div>
</div>
</div>
</div>
<div id=audit-pods-1 class=tab-pane role=tabpanel aria-labelledby=audit-pods-1>
<p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/security/seccomp/alpha/audit-pod.yaml download=pods/security/seccomp/alpha/audit-pod.yaml><code>pods/security/seccomp/alpha/audit-pod.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-security-seccomp-alpha-audit-pod-yaml')" title="Copy pods/security/seccomp/alpha/audit-pod.yaml to clipboard">
</img>
</div>
<div class=includecode id=pods-security-seccomp-alpha-audit-pod-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>audit-pod<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>audit-pod<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>seccomp.security.alpha.kubernetes.io/pod</span>:<span style=color:#bbb> </span>localhost/profiles/audit.json<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>test-container<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>hashicorp/http-echo:0.2.3<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#34;-text=just made some syscalls!&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>allowPrivilegeEscalation</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span></code></pre></div>
</div>
</div>
</div></div>
<br></p>
<p>在集群中创建 Pod：</p>
<pre><code>kubectl apply -f audit-pod.yaml
</code></pre>
<p>这个配置文件并不限制任何系统调用，所以这个 Pod 应该会成功启动。</p>
<pre><code>kubectl get pod/audit-pod
</code></pre><pre><code>NAME        READY   STATUS    RESTARTS   AGE
audit-pod   1/1     Running   0          30s
</code></pre>
<p>为了能够与该容器公开的端点进行交互，请创建一个 NodePort 服务，
该服务允许从 kind 控制平面容器内部访问该端点。</p>
<pre><code>kubectl expose pod/audit-pod --type NodePort --port 5678
</code></pre>
<p>检查这个服务在这个节点上被分配了什么端口。</p>
<pre><code>kubectl get svc/audit-pod
</code></pre><pre><code>NAME        TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
audit-pod   NodePort   10.111.36.142   &lt;none&gt;        5678:32373/TCP   72s
</code></pre>
<p>现在你可以使用 <code>curl</code> 命令从 kind 控制平面容器内部通过该服务暴露出来的端口来访问这个端点。</p>
<pre><code>docker exec -it 6a96207fed4b curl localhost:32373
</code></pre><pre><code>just made some syscalls!
</code></pre>
<p>你可以看到该进程正在运行，但是实际上执行了哪些系统调用？因为该 Pod 是在本地集群中运行的，
你应该可以在 <code>/var/log/syslog</code> 日志中看到这些。打开一个新的终端窗口，使用 <code>tail</code> 命令来
查看来自 <code>http-echo</code> 的调用输出：</p>
<pre><code>tail -f /var/log/syslog | grep 'http-echo'
</code></pre><p>你应该已经可以看到 <code>http-echo</code> 发出的一些系统调用日志，
如果你在控制面板容器内 <code>curl</code> 了这个端点，你会看到更多的日志。</p>
<pre><code>Jul  6 15:37:40 my-machine kernel: [369128.669452] audit: type=1326 audit(1594067860.484:14536): auid=4294967295 uid=0 gid=0 ses=4294967295 pid=29064 comm=&quot;http-echo&quot; exe=&quot;/http-echo&quot; sig=0 arch=c000003e syscall=51 compat=0 ip=0x46fe1f code=0x7ffc0000
Jul  6 15:37:40 my-machine kernel: [369128.669453] audit: type=1326 audit(1594067860.484:14537): auid=4294967295 uid=0 gid=0 ses=4294967295 pid=29064 comm=&quot;http-echo&quot; exe=&quot;/http-echo&quot; sig=0 arch=c000003e syscall=54 compat=0 ip=0x46fdba code=0x7ffc0000
Jul  6 15:37:40 my-machine kernel: [369128.669455] audit: type=1326 audit(1594067860.484:14538): auid=4294967295 uid=0 gid=0 ses=4294967295 pid=29064 comm=&quot;http-echo&quot; exe=&quot;/http-echo&quot; sig=0 arch=c000003e syscall=202 compat=0 ip=0x455e53 code=0x7ffc0000
Jul  6 15:37:40 my-machine kernel: [369128.669456] audit: type=1326 audit(1594067860.484:14539): auid=4294967295 uid=0 gid=0 ses=4294967295 pid=29064 comm=&quot;http-echo&quot; exe=&quot;/http-echo&quot; sig=0 arch=c000003e syscall=288 compat=0 ip=0x46fdba code=0x7ffc0000
Jul  6 15:37:40 my-machine kernel: [369128.669517] audit: type=1326 audit(1594067860.484:14540): auid=4294967295 uid=0 gid=0 ses=4294967295 pid=29064 comm=&quot;http-echo&quot; exe=&quot;/http-echo&quot; sig=0 arch=c000003e syscall=0 compat=0 ip=0x46fd44 code=0x7ffc0000
Jul  6 15:37:40 my-machine kernel: [369128.669519] audit: type=1326 audit(1594067860.484:14541): auid=4294967295 uid=0 gid=0 ses=4294967295 pid=29064 comm=&quot;http-echo&quot; exe=&quot;/http-echo&quot; sig=0 arch=c000003e syscall=270 compat=0 ip=0x4559b1 code=0x7ffc0000
Jul  6 15:38:40 my-machine kernel: [369188.671648] audit: type=1326 audit(1594067920.488:14559): auid=4294967295 uid=0 gid=0 ses=4294967295 pid=29064 comm=&quot;http-echo&quot; exe=&quot;/http-echo&quot; sig=0 arch=c000003e syscall=270 compat=0 ip=0x4559b1 code=0x7ffc0000
Jul  6 15:38:40 my-machine kernel: [369188.671726] audit: type=1326 audit(1594067920.488:14560): auid=4294967295 uid=0 gid=0 ses=4294967295 pid=29064 comm=&quot;http-echo&quot; exe=&quot;/http-echo&quot; sig=0 arch=c000003e syscall=202 compat=0 ip=0x455e53 code=0x7ffc0000
</code></pre>
<p>通过查看每一行上的 <code>syscall=</code> 条目，你可以开始了解 <code>http-echo</code> 进程所需的系统调用。
尽管这些不太可能包含它使用的所有系统调用，但它可以作为该容器的 seccomp 配置文件的基础。</p>
<p>开始下一节之前，请清理该 Pod 和 Service：</p>
<pre><code>kubectl delete pod/audit-pod
kubectl delete svc/audit-pod
</code></pre>
<h2 id=使用导致违规的-seccomp-配置文件创建-pod>使用导致违规的 seccomp 配置文件创建 Pod</h2>
<p>为了进行演示，请将不允许任何系统调用的配置文件应用于 Pod。</p>
<p>为你的 Kubernetes 版本下载正确的清单：</p>
<p><ul class="nav nav-tabs" id=violation-pods role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#violation-pods-0 role=tab aria-controls=violation-pods-0 aria-selected=true>v1.19 或更新版本（GA）</a></li>
<li class=nav-item><a data-toggle=tab class=nav-link href=#violation-pods-1 role=tab aria-controls=violation-pods-1>v1.19 之前版本（alpha）</a></li></ul>
<div class=tab-content id=violation-pods><div id=violation-pods-0 class="tab-pane show active" role=tabpanel aria-labelledby=violation-pods-0>
<p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/security/seccomp/ga/violation-pod.yaml download=pods/security/seccomp/ga/violation-pod.yaml><code>pods/security/seccomp/ga/violation-pod.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-security-seccomp-ga-violation-pod-yaml')" title="Copy pods/security/seccomp/ga/violation-pod.yaml to clipboard">
</img>
</div>
<div class=includecode id=pods-security-seccomp-ga-violation-pod-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>violation-pod<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>violation-pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>seccompProfile</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Localhost<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>localhostProfile</span>:<span style=color:#bbb> </span>profiles/violation.json<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>test-container<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>hashicorp/http-echo:0.2.3<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#34;-text=just made some syscalls!&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>allowPrivilegeEscalation</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span></code></pre></div>
</div>
</div>
</div>
<div id=violation-pods-1 class=tab-pane role=tabpanel aria-labelledby=violation-pods-1>
<p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/security/seccomp/alpha/violation-pod.yaml download=pods/security/seccomp/alpha/violation-pod.yaml><code>pods/security/seccomp/alpha/violation-pod.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-security-seccomp-alpha-violation-pod-yaml')" title="Copy pods/security/seccomp/alpha/violation-pod.yaml to clipboard">
</img>
</div>
<div class=includecode id=pods-security-seccomp-alpha-violation-pod-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>violation-pod<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>violation-pod<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>seccomp.security.alpha.kubernetes.io/pod</span>:<span style=color:#bbb> </span>localhost/profiles/violation.json<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>test-container<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>hashicorp/http-echo:0.2.3<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#34;-text=just made some syscalls!&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>allowPrivilegeEscalation</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span></code></pre></div>
</div>
</div>
</div></div>
<br></p>
<p>在集群中创建 Pod：</p>
<pre><code>kubectl apply -f violation-pod.yaml
</code></pre>
<p>如果你检查 Pod 的状态，你将会看到该 Pod 启动失败。</p>
<pre><code>kubectl get pod/violation-pod
</code></pre><pre><code>NAME            READY   STATUS             RESTARTS   AGE
violation-pod   0/1     CrashLoopBackOff   1          6s
</code></pre>
<p>如上例所示，<code>http-echo</code> 进程需要大量的系统调用。通过设置 <code>"defaultAction": "SCMP_ACT_ERRNO"</code>，
来指示 seccomp 在任何系统调用上均出错。这是非常安全的，但是会删除执行有意义的操作的能力。
你真正想要的只是给工作负载所需的特权。</p>
<p>开始下一节之前，请清理该 Pod 和 Service：</p>
<pre><code>kubectl delete pod/violation-pod
kubectl delete svc/violation-pod
</code></pre>
<h2 id=使用设置仅允许需要的系统调用的-seccomp-配置文件来创建-pod>使用设置仅允许需要的系统调用的 seccomp 配置文件来创建 Pod</h2>
<p>如果你看一下 <code>fine-pod.json</code> 文件，你会注意到在第一个示例中配置文件设置为 <code>"defaultAction": "SCMP_ACT_LOG"</code> 的一些系统调用。
现在，配置文件设置为 <code>"defaultAction": "SCMP_ACT_ERRNO"</code>，但是在 <code>"action": "SCMP_ACT_ALLOW"</code> 块中明确允许一组系统调用。
理想情况下，容器将成功运行，并且你将不会看到任何发送到 <code>syslog</code> 的消息。</p>
<p>为你的 Kubernetes 版本下载正确的清单：</p>
<p><ul class="nav nav-tabs" id=fine-pods role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#fine-pods-0 role=tab aria-controls=fine-pods-0 aria-selected=true>v1.19 或更新版本（GA）</a></li>
<li class=nav-item><a data-toggle=tab class=nav-link href=#fine-pods-1 role=tab aria-controls=fine-pods-1>v1.19 之前版本（alpha）</a></li></ul>
<div class=tab-content id=fine-pods><div id=fine-pods-0 class="tab-pane show active" role=tabpanel aria-labelledby=fine-pods-0>
<p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/security/seccomp/ga/fine-pod.yaml download=pods/security/seccomp/ga/fine-pod.yaml><code>pods/security/seccomp/ga/fine-pod.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-security-seccomp-ga-fine-pod-yaml')" title="Copy pods/security/seccomp/ga/fine-pod.yaml to clipboard">
</img>
</div>
<div class=includecode id=pods-security-seccomp-ga-fine-pod-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>fine-pod<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>fine-pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>seccompProfile</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>Localhost<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>localhostProfile</span>:<span style=color:#bbb> </span>profiles/fine-grained.json<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>test-container<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>hashicorp/http-echo:0.2.3<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#34;-text=just made some syscalls!&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>allowPrivilegeEscalation</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span></code></pre></div>
</div>
</div>
</div>
<div id=fine-pods-1 class=tab-pane role=tabpanel aria-labelledby=fine-pods-1>
<p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/security/seccomp/alpha/fine-pod.yaml download=pods/security/seccomp/alpha/fine-pod.yaml><code>pods/security/seccomp/alpha/fine-pod.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-security-seccomp-alpha-fine-pod-yaml')" title="Copy pods/security/seccomp/alpha/fine-pod.yaml to clipboard">
</img>
</div>
<div class=includecode id=pods-security-seccomp-alpha-fine-pod-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>fine-pod<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>fine-pod<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>seccomp.security.alpha.kubernetes.io/pod</span>:<span style=color:#bbb> </span>localhost/profiles/fine-grained.json<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>test-container<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>hashicorp/http-echo:0.2.3<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#34;-text=just made some syscalls!&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>allowPrivilegeEscalation</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span></code></pre></div>
</div>
</div>
</div></div>
<br></p>
<p>在你的集群上创建Pod：</p>
<pre><code>kubectl apply -f fine-pod.yaml
</code></pre>
<p>Pod 应该被成功启动。</p>
<pre><code>kubectl get pod/fine-pod
</code></pre><pre><code>NAME        READY   STATUS    RESTARTS   AGE
fine-pod   1/1     Running   0          30s
</code></pre>
<p>打开一个新的终端窗口，使用 <code>tail</code> 命令查看来自 <code>http-echo</code> 的调用的输出：</p>
<pre><code>tail -f /var/log/syslog | grep 'http-echo'
</code></pre>
<p>使用 NodePort 服务为该 Pod 开一个端口：</p>
<pre><code>kubectl expose pod/fine-pod --type NodePort --port 5678
</code></pre>
<p>检查服务在该节点被分配了什么端口：</p>
<pre><code>kubectl get svc/fine-pod
</code></pre><pre><code>NAME        TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
fine-pod    NodePort   10.111.36.142   &lt;none&gt;        5678:32373/TCP   72s
</code></pre>
<p>使用 <code>curl</code> 命令从 kind 控制面板容器内部请求这个端点：</p>
<pre><code>docker exec -it 6a96207fed4b curl localhost:32373
</code></pre><pre><code>just made some syscalls!
</code></pre>
<p>你会看到 <code>syslog</code> 中没有任何输出，因为这个配置文件允许了所有需要的系统调用，
并指定如果有发生列表之外的系统调用将发生错误。从安全角度来看，这是理想的情况，
但是在分析程序时需要多付出一些努力。如果有一种简单的方法无需花费太多精力就能更接近此安全性，那就太好了。</p>
<p>开始下一节之前，请清理该 Pod 和 Service：</p>
<pre><code>kubectl delete pod/fine-pod
kubectl delete svc/fine-pod
</code></pre>
<h2 id=使用容器运行时默认的-seccomp-配置文件创建-pod>使用容器运行时默认的 seccomp 配置文件创建 Pod</h2>
<p>大多数容器运行时都提供一组允许或不允许的默认系统调用。通过使用 <code>runtime/default</code> 注释
或将 Pod 或容器的安全上下文中的 seccomp 类型设置为 <code>RuntimeDefault</code>，可以轻松地在 Kubernetes 中应用默认值。</p>
<p>为你的 Kubernetes 版本下载正确的清单：</p>
<p><ul class="nav nav-tabs" id=default-pods role=tablist><li class=nav-item><a data-toggle=tab class="nav-link active" href=#default-pods-0 role=tab aria-controls=default-pods-0 aria-selected=true>v1.19 或更新版本（GA）</a></li>
<li class=nav-item><a data-toggle=tab class=nav-link href=#default-pods-1 role=tab aria-controls=default-pods-1>v1.19 之前版本（alpha）</a></li></ul>
<div class=tab-content id=default-pods><div id=default-pods-0 class="tab-pane show active" role=tabpanel aria-labelledby=default-pods-0>
<p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/security/seccomp/ga/default-pod.yaml download=pods/security/seccomp/ga/default-pod.yaml><code>pods/security/seccomp/ga/default-pod.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-security-seccomp-ga-default-pod-yaml')" title="Copy pods/security/seccomp/ga/default-pod.yaml to clipboard">
</img>
</div>
<div class=includecode id=pods-security-seccomp-ga-default-pod-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>audit-pod<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>audit-pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>seccompProfile</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>type</span>:<span style=color:#bbb> </span>RuntimeDefault<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>test-container<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>hashicorp/http-echo:0.2.3<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#34;-text=just made some syscalls!&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>allowPrivilegeEscalation</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span></code></pre></div>
</div>
</div>
</div>
<div id=default-pods-1 class=tab-pane role=tabpanel aria-labelledby=default-pods-1>
<p>
<div class=highlight>
<div class=copy-code-icon style=text-align:right>
<a href=https://raw.githubusercontent.com/kubernetes/website/main/content/zh/examples/pods/security/seccomp/alpha/default-pod.yaml download=pods/security/seccomp/alpha/default-pod.yaml><code>pods/security/seccomp/alpha/default-pod.yaml</code>
</a>
<img src=/images/copycode.svg style=max-height:24px;cursor:pointer onclick="copyCode('pods-security-seccomp-alpha-default-pod-yaml')" title="Copy pods/security/seccomp/alpha/default-pod.yaml to clipboard">
</img>
</div>
<div class=includecode id=pods-security-seccomp-alpha-default-pod-yaml>
<div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>apiVersion</span>:<span style=color:#bbb> </span>v1<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>kind</span>:<span style=color:#bbb> </span>Pod<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>metadata</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>default-pod<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>labels</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>app</span>:<span style=color:#bbb> </span>default-pod<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>annotations</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>seccomp.security.alpha.kubernetes.io/pod</span>:<span style=color:#bbb> </span>runtime/default<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>spec</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>containers</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>test-container<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>image</span>:<span style=color:#bbb> </span>hashicorp/http-echo:0.2.3<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>args</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span>- <span style=color:#b44>&#34;-text=just made some syscalls!&#34;</span><span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>securityContext</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>allowPrivilegeEscalation</span>:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>false</span></code></pre></div>
</div>
</div>
</div></div>
<br></p>
<p>默认的 seccomp 配置文件应该为大多数工作负载提供足够的权限。</p>
<h2 id=接下来>接下来</h2>
<p>额外的资源：</p>
<ul>
<li><a href=https://lwn.net/Articles/656307/>seccomp 概要</a></li>
<li><a href=https://docs.docker.com/engine/security/seccomp/>Seccomp 在 Docker 中的安全配置</a></li>
</ul>
</div>
</main>
</div>
</div>
<footer class=d-print-none>
<div class=footer__links>
<nav>
<a class=text-white href=/zh/docs/home/>主页</a>
<a class=text-white href=/zh/blog/>博客</a>
<a class=text-white href=/zh/training/>培训</a>
<a class=text-white href=/zh/partners/>合作伙伴</a>
<a class=text-white href=/zh/community/>社区</a>
<a class=text-white href=/zh/case-studies/>案例分析</a>
</nav>
</div>
<div class=container-fluid>
<div class=row>
<div class="col-6 col-sm-2 text-xs-center order-sm-2">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list">
<a class=text-white target=_blank href=https://discuss.kubernetes.io>
<i class="fa fa-envelope"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter>
<a class=text-white target=_blank href=https://twitter.com/kubernetesio>
<i class="fab fa-twitter"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Calendar aria-label=Calendar>
<a class=text-white target=_blank href="https://calendar.google.com/calendar/embed?src=calendar%40kubernetes.io">
<i class="fas fa-calendar-alt"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Youtube aria-label=Youtube>
<a class=text-white target=_blank href=https://youtube.com/kubernetescommunity>
<i class="fab fa-youtube"></i>
</a>
</li>
</ul>
</div>
<div class="col-6 col-sm-2 text-right text-xs-center order-sm-3">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub>
<a class=text-white target=_blank href=https://github.com/kubernetes/kubernetes>
<i class="fab fa-github"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack>
<a class=text-white target=_blank href=https://slack.k8s.io>
<i class="fab fa-slack"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Contribute aria-label=Contribute>
<a class=text-white target=_blank href=https://git.k8s.io/community/contributors/guide>
<i class="fas fa-edit"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow">
<a class=text-white target=_blank href=https://stackoverflow.com/questions/tagged/kubernetes>
<i class="fab fa-stack-overflow"></i>
</a>
</li>
</ul>
</div>
<div class="col-12 col-sm-8 text-center order-sm-2">
<small class=text-white>&copy; 2023 The Kubernetes 作者 | 文档发布基于 <a href=https://git.k8s.io/website/LICENSE class=light-text>CC BY 4.0</a> 授权许可</small>
<br>
<small class=text-white>Copyright &copy; 2023 Linux 基金会&reg;。保留所有权利。Linux 基金会已注册并使用商标。如需了解 Linux 基金会的商标列表，请访问<a href=https://www.linuxfoundation.org/trademark-usage class=light-text>商标使用页面</a></small>
<br>
<small class=text-white>ICP license: 京ICP备17074266号-3</small>
</div>
</div>
</div>
</footer>
</div>
<script src=/js/popper-1.14.3.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script>
<script src=/js/bootstrap-4.3.1.min.js integrity=sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM crossorigin=anonymous></script>
<script src=/js/main.min.40616251a9b6e4b689e7769be0340661efa4d7ebb73f957404e963e135b4ed52.js integrity="sha256-QGFiUam25LaJ53ab4DQGYe+k1+u3P5V0BOlj4TW07VI=" crossorigin=anonymous></script>
</body>
</html>